<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RifqyConverter</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#121212; --text:#f0f0f0; --muted:#cfcfcf; --card:#1e1e1e; --accent:#007bff; --danger:#dc3545; --border:#2a2a2a; --ok:#22c55e;
    }
    html, body{ margin:0; padding:0; overflow-x:hidden; font-family:'Poppins',sans-serif; background:var(--bg); color:var(--text); }
    .container{ padding:16px; max-width:720px; margin:0 auto; }
    header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; }
    header h1{ font-size:1.4rem; margin:0; }
    .desc{ font-size:0.95rem; color:var(--muted); margin-bottom:12px; }
    .controls{ display:flex; gap:8px; }
    .btn{ padding:10px 14px; border:none; border-radius:8px; font-weight:600; cursor:pointer; color:#fff; background:var(--accent); }
    .btn.secondary{ background:#444; }
    .btn.ghost{ background:transparent; border:1px solid var(--border); color:var(--text); }
    .grid{ display:grid; grid-template-columns:1fr; gap:14px; }
    @media(min-width:640px){ .grid{ grid-template-columns:1fr 1fr; } }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:12px; padding:14px; box-shadow:0 2px 6px rgba(0,0,0,0.25); transition:transform .2s ease; }
    .card:hover{ transform:scale(1.01); }
    .card h2{ margin:0 0 8px; font-size:1.1rem; }
    .card p{ margin:0 0 10px; font-size:0.9rem; color:var(--muted); }
    .form{ display:grid; grid-template-columns:1fr; gap:10px; }
    .row{ display:flex; gap:10px; }
    .row > *{ flex:1; }
    input, select{
      width:100%; padding:12px; border-radius:10px; border:1px solid var(--border);
      background:#141414; color:var(--text); box-sizing:border-box; font-size:0.95rem;
    }
    .inline-actions{ display:flex; gap:8px; align-items:center; }
    .swap{ padding:10px 12px; border:1px solid var(--border); border-radius:10px; background:#161616; cursor:pointer; font-weight:600; }
    .result{ margin-top:4px; padding:10px; border-radius:10px; background:#151515; border:1px solid var(--border); font-weight:600; display:flex; justify-content:space-between; align-items:center; gap:8px; }
    .note{ font-size:0.85rem; color:var(--muted); margin-top:6px; }
    .chips{ display:flex; flex-wrap:wrap; gap:8px; }
    .chip{ padding:8px 12px; border-radius:999px; border:1px solid var(--border); background:#161616; cursor:pointer; font-weight:600; font-size:0.85rem; }
    .tabs{ display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap; }
    .tab{ padding:8px 12px; border-radius:999px; border:1px solid var(--border); background:#161616; color:var(--text); cursor:pointer; font-weight:600; }
    .tab.active{ background:var(--accent); border-color:var(--accent); }
    .hidden{ display:none !important; }
    .footer{ margin-top:18px; text-align:center; font-size:0.85rem; color:var(--muted); }
    .msg{ margin-top:6px; font-size:0.85rem; }
    .msg.ok{ color:var(--ok); }
    .msg.err{ color:#ef4444; }
    .copy{ padding:6px 10px; border:1px solid var(--border); background:#1a1a1a; border-radius:8px; cursor:pointer; font-size:0.85rem; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>RifqyConverter</h1>
      <div class="controls">
        <button class="btn secondary" id="toggleTheme">üåó Mode</button>
      </div>
    </header>

    <div class="tabs">
      <button class="tab active" data-target="currency">üí± Mata Uang</button>
      <button class="tab" data-target="units">üìè Satuan</button>
      <button class="tab" data-target="data">üíæ Data</button>
    </div>

    <!-- Mata Uang -->
    <section id="currency" class="card">
      <h2>üí± Konversi Mata Uang</h2>
      <p>Kalkulasi real-time dengan fallback otomatis bila sumber kurs gagal.</p>
      <div class="chips">
        <span class="chip" data-pair="USD-IDR">USD ‚Üí IDR</span>
        <span class="chip" data-pair="EUR-IDR">EUR ‚Üí IDR</span>
      </div>
      <div class="form">
        <div class="row">
          <input type="number" id="curAmount" placeholder="Jumlah" min="0" step="any">
        </div>
        <div class="row">
          <select id="curFrom"></select>
          <select id="curTo"></select>
        </div>
        <div class="inline-actions">
          <button class="swap" id="curSwap">‚ÜîÔ∏è Swap</button>
          <button class="btn" id="curConvert">Konversi</button>
        </div>
        <div id="curResult" class="result">
          <span>Hasil akan tampil di sini.</span>
          <button class="copy" data-copy="currency">Salin</button>
        </div>
        <div id="curMsg" class="msg"></div>
        <div class="note">Sumber nilai tukar utama: exchangerate.host (/convert). Fallback: frankfurter.app (/latest). Cache lokal sementara 6 jam.</div>
      </div>
    </section>

    <!-- Satuan -->
    <section id="units" class="card hidden">
      <h2>üìè Konversi Satuan</h2>
      <p>Panjang, berat, suhu, dan volume.</p>
      <div class="chips">
        <span class="chip" data-unit="cm-inch">cm ‚Üí inch</span>
        <span class="chip" data-unit="C-F">¬∞C ‚Üí ¬∞F</span>
      </div>
      <div class="form">
        <div class="row">
          <select id="unitCategory">
            <option value="length">Panjang</option>
            <option value="weight">Berat</option>
            <option value="temperature">Suhu</option>
            <option value="volume">Volume</option>
          </select>
          <input type="number" id="unitValue" placeholder="Nilai" step="any">
        </div>
        <div class="row">
          <select id="unitFrom"></select>
          <select id="unitTo"></select>
        </div>
        <div class="inline-actions">
          <button class="swap" id="unitSwap">‚ÜîÔ∏è Swap</button>
          <button class="btn" id="unitConvert">Konversi</button>
        </div>
        <div id="unitResult" class="result">
          <span>Hasil akan tampil di sini.</span>
          <button class="copy" data-copy="units">Salin</button>
        </div>
      </div>
    </section>

    <!-- Data -->
    <section id="data" class="card hidden">
      <h2>üíæ Konversi Data Digital</h2>
      <p>Basis biner (1024): Byte, KB, MB, GB, TB.</p>
      <div class="chips">
        <span class="chip" data-data="MB-GB">MB ‚Üí GB</span>
        <span class="chip" data-data="GB-MB">GB ‚Üí MB</span>
      </div>
      <div class="form">
        <div class="row">
          <input type="number" id="dataAmount" placeholder="Jumlah" step="any">
        </div>
        <div class="row">
          <select id="dataFrom">
            <option>Byte</option><option>KB</option><option>MB</option><option>GB</option><option>TB</option>
          </select>
          <select id="dataTo">
            <option>KB</option><option>MB</option><option>GB</option><option>TB</option><option>Byte</option>
          </select>
        </div>
        <div class="inline-actions">
          <button class="swap" id="dataSwap">‚ÜîÔ∏è Swap</button>
          <button class="btn" id="dataConvert">Konversi</button>
        </div>
        <div id="dataResult" class="result">
          <span>Hasil akan tampil di sini.</span>
          <button class="copy" data-copy="data">Salin</button>
        </div>
      </div>
      <p class="note">Catatan: 1 KB = 1024 Byte, 1 MB = 1024 KB, dst.</p>
    </section>

    <p class="footer">¬© RifqyDev Suite ‚Äî dibuat dengan semangat belajar dan rapi.</p>
  </div>

  <script>
    // Theme toggle (persist)
    (() => {
      const btn = document.getElementById('toggleTheme');
      const saved = localStorage.getItem('rifqyTheme');
      if (saved === 'light') setTheme('light');
      btn.addEventListener('click', () => {
        const current = localStorage.getItem('rifqyTheme') || 'dark';
        setTheme(current === 'dark' ? 'light' : 'dark');
      });
      function setTheme(mode){
        if (mode==='light'){
          document.documentElement.style.setProperty('--bg', '#f4f4f4');
          document.documentElement.style.setProperty('--text', '#0b0b0b');
          document.documentElement.style.setProperty('--muted', '#444');
          document.documentElement.style.setProperty('--card', '#ffffff');
          document.documentElement.style.setProperty('--border', '#e8e8e8');
          localStorage.setItem('rifqyTheme','light');
        } else {
          document.documentElement.style.setProperty('--bg', '#121212');
          document.documentElement.style.setProperty('--text', '#f0f0f0');
          document.documentElement.style.setProperty('--muted', '#cfcfcf');
          document.documentElement.style.setProperty('--card', '#1e1e1e');
          document.documentElement.style.setProperty('--border', '#2a2a2a');
          localStorage.setItem('rifqyTheme','dark');
        }
      }
    })();

    // Tabs
    document.querySelectorAll('.tab').forEach(tab=>{
      tab.addEventListener('click',()=>{
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        const target = tab.dataset.target;
        document.querySelectorAll('section.card').forEach(sec=>{
          sec.id === target ? sec.classList.remove('hidden') : sec.classList.add('hidden');
        });
      });
    });

    // Currency list + presets
    const currencyList = ['IDR','USD','EUR','GBP','JPY','AUD','CAD','SGD','MYR','HKD','CNY','KRW','THB','TWD'];
    const curFrom = document.getElementById('curFrom');
    const curTo = document.getElementById('curTo');
    currencyList.forEach(c=>{
      const o1=document.createElement('option'); o1.value=c; o1.textContent=c;
      const o2=document.createElement('option'); o2.value=c; o2.textContent=c;
      curFrom.appendChild(o1); curTo.appendChild(o2);
    });
    curFrom.value='IDR'; curTo.value='USD';

    // Debounce helper
    function debounce(fn, delay=300){
      let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), delay); };
    }

    // Currency conversion with primary + fallback + local cache
    const curAmountEl = document.getElementById('curAmount');
    const curResultEl = document.getElementById('curResult').querySelector('span');
    const curMsgEl = document.getElementById('curMsg');

    async function getRate(from, to){
      const cacheKey = `rate_${from}_${to}`;
      const cached = JSON.parse(localStorage.getItem(cacheKey) || 'null');
      const now = Date.now();
      if (cached && (now - cached.time) < 6*60*60*1000) return cached.rate; // 6 jam cache

      // primary: exchangerate.host /convert
      try{
        const url = `https://api.exchangerate.host/convert?from=${encodeURIComponent(from)}&to=${encodeURIComponent(to)}`;
        const res = await fetch(url, {mode:'cors'});
        if (!res.ok) throw new Error('exchangerate host failed');
        const data = await res.json();
        const rate = data.info?.rate ?? data.result ? (data.result / 1) / (parseFloat((curAmountEl.value||'1')) || 1) : data.info?.rate;
        // Jika result tersedia tapi info.rate tidak, gunakan panggilan /latest sebagai cadangan internal
        let finalRate = data.info?.rate;
        if (!finalRate && typeof data.result === 'number'){
          const amount = parseFloat(curAmountEl.value || '1') || 1;
          finalRate = data.result / amount;
        }
        if (!finalRate) throw new Error('no rate from convert');
        localStorage.setItem(cacheKey, JSON.stringify({rate: finalRate, time: now}));
        return finalRate;
      } catch(e){
        // fallback: frankfurter.app /latest
        try{
          const url2 = `https://api.frankfurter.app/latest?from=${encodeURIComponent(from)}&to=${encodeURIComponent(to)}`;
          const res2 = await fetch(url2, {mode:'cors'});
          if (!res2.ok) throw new Error('frankfurter failed');
          const data2 = await res2.json();
          const rate2 = data2.rates?.[to];
          if (!rate2) throw new Error('no rate from frankfurter');
          localStorage.setItem(cacheKey, JSON.stringify({rate: rate2, time: now}));
          return rate2;
        } catch(e2){
          throw new Error('All sources failed');
        }
      }
    }

    async function convertCurrency(){
      curMsgEl.textContent = '';
      const amount = parseFloat(curAmountEl.value || '0');
      const from = curFrom.value; const to = curTo.value;
      if (!amount || amount <= 0){ curResultEl.textContent = 'Masukkan jumlah yang valid.'; return; }
      if (from === to){ curResultEl.textContent = `${amount.toLocaleString()} ${to}`; return; }
      try{
        const rate = await getRate(from, to);
        const result = amount * rate;
        curResultEl.textContent = `${amount.toLocaleString()} ${from} = ${result.toLocaleString(undefined,{maximumFractionDigits:6})} ${to}`;
        curMsgEl.textContent = `Kurs: 1 ${from} = ${rate.toLocaleString(undefined,{maximumFractionDigits:6})} ${to}`;
        curMsgEl.className = 'msg ok';
      }catch(e){
        curResultEl.textContent = 'Tidak bisa memuat nilai tukar. Coba lagi.';
        curMsgEl.textContent = 'Sumber kurs gagal (jaringan atau diblokir).';
        curMsgEl.className = 'msg err';
      }
    }

    document.getElementById('curConvert').addEventListener('click', convertCurrency);
    curAmountEl.addEventListener('input', debounce(convertCurrency, 400));
    curFrom.addEventListener('change', convertCurrency);
    curTo.addEventListener('change', convertCurrency);
    document.getElementById('curSwap').addEventListener('click', ()=>{
      const tmp = curFrom.value; curFrom.value = curTo.value; curTo.value = tmp; convertCurrency();
    });
    document.querySelectorAll('.chip[data-pair]').forEach(ch=>{
      ch.addEventListener('click', ()=>{
        const [f,t] = ch.dataset.pair.split('-'); curFrom.value=f; curTo.value=t; convertCurrency();
      });
    });

    // Copy result buttons
    document.querySelectorAll('.copy').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const type = btn.dataset.copy;
        let text = '';
        if (type==='currency') text = document.querySelector('#curResult span').textContent;
        if (type==='units') text = document.querySelector('#unitResult span').textContent;
        if (type==='data') text = document.querySelector('#dataResult span').textContent;
        if (!text || /Hasil akan tampil/.test(text)) return;
        navigator.clipboard.writeText(text).then(()=>{
          btn.textContent = 'Disalin ‚úì';
          setTimeout(()=>btn.textContent='Salin', 1200);
        });
      });
    });

    // Units
    const unitCategory = document.getElementById('unitCategory');
    const unitFrom = document.getElementById('unitFrom');
    const unitTo = document.getElementById('unitTo');
    const unitValue = document.getElementById('unitValue');
    const unitResultEl = document.getElementById('unitResult').querySelector('span');

    const UNITS = {
      length: { base:'m', map:{ mm:0.001, cm:0.01, m:1, km:1000, inch:0.0254, ft:0.3048, yd:0.9144, mile:1609.344 } },
      weight: { base:'kg', map:{ mg:1e-6, g:1e-3, kg:1, lb:0.45359237, oz:0.028349523125 } },
      temperature: { },
      volume: { base:'l', map:{ ml:0.001, l:1, gallon_us:3.785411784 } }
    };
    function populateUnits(){
      const cat = unitCategory.value;
      unitFrom.innerHTML=''; unitTo.innerHTML='';
      if (cat === 'temperature'){
        ['C','F','K'].forEach(u=>{
          unitFrom.append(new Option(u,u));
          unitTo.append(new Option(u,u));
        });
        unitFrom.value='C'; unitTo.value='F';
      } else {
        Object.keys(UNITS[cat].map).forEach(u=>{
          const label = u==='gallon_us'?'gallon (US)':u;
          unitFrom.append(new Option(label,u));
          unitTo.append(new Option(label,u));
        });
        unitFrom.selectedIndex=0; unitTo.selectedIndex=1;
      }
    }
    unitCategory.addEventListener('change', ()=>{ populateUnits(); convertUnits(); });
    populateUnits();

    function convertUnits(){
      const cat = unitCategory.value;
      const val = parseFloat(unitValue.value || '0');
      const from = unitFrom.value; const to = unitTo.value;
      if (!val && val !== 0){ unitResultEl.textContent='Masukkan nilai yang valid.'; return; }
      if (from === to){ unitResultEl.textContent = `${val} ${to}`; return; }

      if (cat === 'temperature'){
        let c;
        if (from==='C') c = val;
        else if (from==='F') c = (val - 32) * 5/9;
        else if (from==='K') c = val - 273.15;
        let result;
        if (to==='C') result = c;
        else if (to==='F') result = (c * 9/5) + 32;
        else if (to==='K') result = c + 273.15;
        unitResultEl.textContent = `${val} ${from} = ${Number(result.toFixed(6))} ${to}`;
        return;
      }
      const map = UNITS[cat].map;
      const inBase = val * map[from];
      const result = inBase / map[to];
      unitResultEl.textContent = `${val} ${from} = ${Number(result.toFixed(6))} ${to}`;
    }
    document.getElementById('unitConvert').addEventListener('click', convertUnits);
    unitValue.addEventListener('input', debounce(convertUnits, 400));
    unitFrom.addEventListener('change', convertUnits);
    unitTo.addEventListener('change', convertUnits);
    document.getElementById('unitSwap').addEventListener('click', ()=>{
      const tmp = unitFrom.value; unitFrom.value = unitTo.value; unitTo.value = tmp; convertUnits();
    });
    document.querySelectorAll('.chip[data-unit]').forEach(ch=>{
      ch.addEventListener('click', ()=>{
        const [f,t] = ch.dataset.unit.split('-'); unitCategory.value = inferCategory(f,t); populateUnits(); unitFrom.value=fMap(f); unitTo.value=fMap(t); convertUnits();
        function inferCategory(a,b){ if (['C','F','K'].includes(a)||['C','F','K'].includes(b)) return 'temperature'; if (['kg','lb','oz','g','mg'].includes(a)||['kg','lb','oz','g','mg'].includes(b)) return 'weight'; if (['cm','inch','mm','m','km','ft','yd','mile'].includes(a)||['cm','inch','mm','m','km','ft','yd','mile'].includes(b)) return 'length'; return 'volume'; }
        function fMap(u){ return u==='inch'?'inch':u; }
      });
    });

    // Data (binary 1024)
    const dataAmountEl = document.getElementById('dataAmount');
    const dataResultEl = document.getElementById('dataResult').querySelector('span');
    const DATA_MAP = { Byte:1, KB:1024, MB:1024**2, GB:1024**3, TB:1024**4 };
    function convertData(){
      const amount = parseFloat(dataAmountEl.value || '0');
      const from = document.getElementById('dataFrom').value;
      const to = document.getElementById('dataTo').value;
      if (!amount && amount !== 0){ dataResultEl.textContent='Masukkan jumlah yang valid.'; return; }
      const bytes = amount * DATA_MAP[from];
      const result = bytes / DATA_MAP[to];
      dataResultEl.textContent = `${amount} ${from} = ${Number(result.toFixed(6))} ${to}`;
    }
    document.getElementById('dataConvert').addEventListener('click', convertData);
    dataAmountEl.addEventListener('input', debounce(convertData, 400));
    document.getElementById('dataFrom').addEventListener('change', convertData);
    document.getElementById('dataTo').addEventListener('change', convertData);
    document.getElementById('dataSwap').addEventListener('click', ()=>{
      const from = document.getElementById('dataFrom'); const to = document.getElementById('dataTo');
      const tmp = from.value; from.value = to.value; to.value = tmp; convertData();
    });
  </script>
</body>
</html>
